<!doctype html>
<html lang="en">
<head>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Bootstrap CSS -->
<link rel="stylesheet"
	href="/resources/bootstrap.min.css"
	 >
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="/resources/jquery-3.3.1.slim.min.js"
	 ></script>
<script
	src="/resources/popper.min.js"
	 ></script>
<script
	src="/resources/bootstrap.min.js"
	 ></script>
<script
	src="/resources/jquery.min.js"></script>

<title>HotChat</title>
<script>

      
							$('.alert').hide();
							var urlBase = 'http://localhost:8124/'
							function cadastrarUsuario() {

								if ($('#senhaCadastro').val() != $('#senhaCadastro2').val()) {
									alert('Senhas não conferem.')
								} else {
									$.post(urlBase + 'api/users', {
						                  nome : $('#nomeCadastro').val(),
						                  login : $('#loginCadastro').val(),
						                  senha : $('#senhaCadastro').val()
						                }, function(data, status) {
						                	if (data){
						                		if (data == 'sucesso'){
						                		 $('#btnFechaPopup').click()
					                      alert('Cadastrado com sucesso!')
					                       limpaTela()
					                      }else{
					                    	  alert(data)
					                      }
									
						                	}else{
						                		 alert('Erro ao Cadastrar!')
						                	}
						                 
						                });
									
								}
							}

							function fazLogin() {
								$.post(urlBase + 'api/user/login', {
									login : $('#login').val(),
									senha : $('#senha').val()
								}, function(data, status) {
									if (data) {
										store.setItem('usuario', data.nome);
										store.setItem('token', data.token);
										document.location = 'chat.html' 
									} else {
										alert('Senhas não conferem...')
									}
								});
							}
							
							function limpaTela(){ 
							$('#nomeCadastro').val(''),
               $('#loginCadastro').val(''),
               $('#senhaCadastro').val('')
                $('#senhaCadastro2').val('')
							}
               
							
						      function storageFactory(storage) {
						          let inMemoryStorage = {}; 

						          function isSupported() {
						            try {
						              const key = "__some_random_key_you_are_not_going_to_use__";
						              storage.setItem(key, key);
						              storage.removeItem(key);
						              return true;
						            } catch (e) {
						              return false;
						            }
						          }

						          function getItem(key) {
						            if (isSupported()) {
						              return storage.getItem(key);
						            }
						            return inMemoryStorage[key] || null;
						          }

						          function setItem(key, value) {
						            if (isSupported()) {
						              storage.setItem(key, value);
						            } else {
						              inMemoryStorage[key] = value;
						            }
						          }

						          function removeItem(key) {
						            if (isSupported()) {
						              storage.removeItem(key);
						            } else {
						              delete inMemoryStorage[key];
						            }
						          }

						          function clear(key) {
						            if (isSupported()) {
						              storage.clear();
						            } else {
						              inMemoryStorage = {};
						            }
						          }
						          
						          function key(n) {
						            if (isSupported()) {
						              return storage.key(n);
						            } else {
						               return Object.keys(inMemoryStorage)[n] || null;
						            }
						          }

						          return {
						            getItem,
						            setItem,
						            removeItem,
						            clear,
						            key,
						          };
						        }
						       var store = storageFactory(localStorage);
						</script>
</head>
<body>
	<h1 align="center">Bem Vindo</h1>

	<div class="card" style="width: 40%; margin-left: 29%;">
		<div class="card-body">

			<div class="form-group">

				<input type="text" class="form-control" id="login"
					aria-describedby="emailHelp" placeholder="Login"> <small
					id="emailHelp" class="form-text text-muted"></small>
			</div>
			<div class="form-group">
				<input type="password" class="form-control" id="senha"
					placeholder="Senha">
			</div>
			<div class="form-group" align="center">
				<button type="submit" class="btn btn-primary" onclick="fazLogin()">Entrar</button>
				<BR /> <BR /> <small data-toggle="modal"
					data-target="#popupCadastro" id="novoCadastro"
					class="form-text text-muted">Novo cadastro</small>
			</div>

		</div>
	</div>

	<!-- Modal -->
	<div class="modal fade" id="popupCadastro" tabindex="-1" role="dialog"
		aria-labelledby="exampleModalLongTitle" aria-hidden="true">
		<form>
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLongTitle">Novo
							Usuário</h5>
						<button type="button" id="btnFechaPopup" class="close"
							data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<div class="form-group">
							<input type="text" required class="form-control"
								id="nomeCadastro" aria-describedby="emailHelp"
								placeholder="Nome"> <br /> <input type="email" required
								class="form-control" id="loginCadastro"
								aria-describedby="emailHelp" placeholder="Login"> <br />
							<input type="password" required class="form-control"
								id="senhaCadastro" aria-describedby="emailHelp"
								placeholder="Senha"> <br /> <input type="password"
								required class="form-control" id="senhaCadastro2"
								aria-describedby="emailHelp" placeholder="Repita Senha">
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-dismiss="modal">Fechar</button>
						<button type="button" class="btn btn-primary"
							onclick="cadastrarUsuario()">Salvar</button>
					</div>
				</div>
			</div>
		</form>
	</div>



</body>
</html>